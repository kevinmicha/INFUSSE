import argparse
import glob
import os
import numpy as np
import torch

from gcn_bf.config import ADJACENCIES_DIR, CM_DIR, DATA_DIR, STRUCTURE_DIR
from gcn_bf.utils.biology_utils import compute_average_b_factors, get_first_digit, parse_pdb

parser = argparse.ArgumentParser()
parser.add_argument('--thr', type=int, default=100)
args = parser.parse_args()

folder = STRUCTURE_DIR
file_list = list(dict.fromkeys(sorted([file for file in glob.glob(os.path.join(folder, '*.pdb')) if '_stripped' not in file], key=get_first_digit)))

pdb_codes = []
b_factors = []
pathological = ['1i8m', '1zea', '2fr4', '2r8s', '3eys', '3vw3', '4lrn', '4kze', '5e08', '5j75', '5xli', '6b14', '6b3k', '6ca7', '6db9', '6df1', '6df2', '6o2a', '6o2b', '6ulf', '6vln', '7bem', '7kmh', '7t0w', '7vux', '7ums', '7xq8', '8dis', '8dp3', '8e8r', '8e8s', '8e8x', '8gb8', '8hrh', '8jgg', '8sh5', '8vs8']
pathological += ['1rzg', '2vq1', '4ncc', '5drn', '6vor', '7kgu', '7pa7', '7rdk'] # unbound
pathological += ['1oay', '1oau', '4nm8', '4bkl', '7bep', '7yud', '8hrx', '8fja', '8st0'] + ['8gsf', '8gse', '8gsc', '8gsd'] # when putting bound and unbound together
pathological += ['2ok0', '4z8f', '5ds8', '5dub', '5fgb', '6db8' ,'6u8d', '6x1s', '6x1u', '6x1w', '6xjq', '6xjw', '7t86', '7v5n', '8d29', '3v6o', '8de4', '7yar'] # ext_ext
#pathological += ['8ia6','8ia6','8h3b','8h3b','8h73','8dy0','8dy0','8dy2','8dy2','8dy2','8dy2','8dy3','8dy4','7pkl','5gs3','5gs3','6kr0','6kr0','6kr0','6kr0','6vun','6vun','4buh','4buh','6qf6','6qf6','6qf6','6qf6','3auv','3auv','3auv','3auv','3auv','3auv','5grx','5grx','5grz','5grz','5c6w','5c6w','6qf9','6qf9','5gs1','5gs1','5gs1','5gs1','5gs1','5gs1','5gs1','5gs1','5gs1','5gs1','3juy','3juy','3juy','3juy','3juy','3juy','6ehv','6nou','6ffj','6ffj','6ffj','6ffj','5grw','5grw','7kbm','6g8r','7kbp','7kbp','7kbp','7kbp','2a9m','2a9m','6ehy','6ehy','6j9o','5gry','5gry','6ehw','6dsi','6vrp','6vrp','6vuo','6vuo','7ah1','6qb9','6qb9','5fcs','5fcs','6vup','6tcs','1x9q','7kbo','6ehx','5c2b','8soz','8u5l','8u5l','8u5l','8u5l','8u5l','8yww','8rz0','8rz0','8rz0','8rz0','8rz1','8rz1','8pmz','8pmz','8xqo','8xqt','8yky','8zqe','8wz2','8pwv','8pwv','8pwv','8pwv','8pww','8pww','8jin','8jin','8uwl','8v6u','8jpn','8j6i','8r4o','8r4o','8r4o','8r4o','8r4o','8r4o','8r4q','8r4q','8r4q','8r4q','8r4q','8r4q','8r4u','8r4u','8r4u','8r4u','8kfx','8i5l','8i5l','8j24','8j6j','8jgb','8jgf','8jgg','8ija','8hn8','8hoc','8ek5','8hnl','8hnm','8w8b','8bg1','8bg1','8bg1','8bg1','8bg2','8bg2','8bg3','8bg3','8bg4','8bg4','8bg5','8bg5','8bec','8bec','8g05','8fx5','4kv5','4kv5','4kv5','4kv5','8gpy','8gpy','8gho','8gho','7yix','7yix','8ezk','8ezk','8ezm','8thk','2ybr','2ybr','2ybr','5xj4','8iys','8cz8','8cz8','8cz8','8cz8','7xxh','8eit','8ejc','8gur','8gus','8gut','8dy1','8dy1','8dy5','8dy5','8id3','8id4','8id6','8id8','8id9','7x9y','7vkt','7xa3','8g59','8hs3','7w3z','7w40','7xk2','7u9e','7u9e','7u9w','7ua2','7ua2','7ua8','7ua8','7ubs','7ubs','7ubs','7ubs','7uc8','7uc8','7uc8','7ucq','7ucq','7ucq','7ucq','7ufw','7ufw','7yue','7wqv','7wqv','7wqv','7wqv','7wqv','7wqv','7wqv','7wqv','7wos','7wos','7wos','7wos','7wop','7wop','7woq','7wor','7wor','7wor','7wou','7wou','7wou','7wou','7wov','7wov','7wov','7wov','7wov','7wov','7wow','7wow','7wow','7wow','7wow','7wow','7wow','7wow','7wow','7wow','7wow','7wow','8e9y','7x10','7wyb','7y24','7y26','7y27','7zce','7zce','7zce','7zcf','7wy0','7wz7','7srr','8dpf','8dpg','8dph','8dpi','7wj5','7ran','7eo4','5cbe','5cbe','8dce','4yjz','5j75','5j75','6y6c','6y6c','5iwl','5iwl','7eo2','7jum','7jum','7jum','6i07','6i07','7tzh','7tzh','5cba','5cba','6tou','7vdm','3kdm','3kdm','7vla','5yax','5yax','7vv5','7vv3','6oan','6oan','7cu5','7cu5','5j74','5j74','7vuy','2a9n','2a9n','7vl8','7deo','7deo','3ux9','3ux9','7f15','7vmu','6qb3','6cbp','6qb4','6qfc','7w56','6kpg','7vdh','6kpf','5f72','5f72','7xjl','2ghw','2ghw','5wn9','7vuz','7xjk','7vl9','7w55'] # scFv

pathological += [
    "4g6a","4g6a","6mu7","6mu7","5k9q","5k9q","5k9q","5k9q","5k9q","5k9q","6mub","6mub","8u32","8u32","8wsp","8wsp","8gpy","8gpy","7x8t","7x8t","7x8t","7x8t","4xnm","4xnm","3qcv","3qcv","7e3o","7daa","6w05","1n8z","7bem","7bel","7bel","7bel","7bel","4yhp","4yhp","4yhp","4yhp","7bsd","7bsd","7sbu","7phu","7phu","7su1","6wg2","6wg2","8vma","8vma","5drz","5drz","7re7","7re7","2ybr","2ybr","2ybr","6q18","6xkq","3g04","3t2n","3t2n","6ule","6ule","6bft","6bft","6nmu","6nmu","4lst","6wtu","6wtu","6wtu","6wtu","7dha","2pw2","6oz2","6mu6","6mu6","8c2r","8c2r","8hpu","8hpu","5bo1","5bo1","1u8n","4u6v","4u6v","7cho","7cho","8e1g","8e1g","6fy0","6fy0","6n81","6n81","3b2u","3b2u","3b2u","3b2u","3b2u","3b2u","3b2u","3b2u","6tou","8w0v","7uvh","7uvh","7t7b","6xkr","6wfx","4lss","8tbq","8tbq","6ktr","6ktr","6xpx","6db5","6db5","8q5y","8q5y","8q5y","8tv1","8j24","8r8d","8r8d","8ez7","8euv","8euv","8euv","8thk","8ol9","8cz8","8cz8","8cz8","8cz8","7xjf","7zjl","7zjl","7zjl","7yck","7yck","7wvg","8gv7","7t1x","7uvf","7uvf","8dcc","5w08","5w08","5w08","5w08","5w08","5w08","6rp8","6rp8","7k43","7k43","7k43","1u8l","2pw1","7lxz","7lxz","7lxz","7lxz","7lxz","7lxz","7ahu","7ahu","7r8l","7r8l","7ora","7ora","7ora","7ora","6fy3","6fy3","3mob","6E+63","6E+63","3dvg","4g3y","6d2p","6bfq","6bfq","6bfq","6bfq","6o42","6o42","7kqg","2xqb","7rta","5bk2","5bk2","7x9e","7x9e","6whk","7kqk","7kqk","6nnj","6nnj","6nnj","5d72","5d72","1axs","1axs","5ocy","7ly0","7lbg","7lbg","4jb9","4hs8","6o9i","6o9i","3bdy","6vy6","7vl9","6bkc","5zia","5zia","5zia","5zia","5zia","5zia","4y5v","4y5v","4y5v","5lsp","5lsp","8vvk","8vvk","8xsj","4dkf","4dkf","3jwd","3jwd","7bep","7bep","7bep","7bep","2hfg","6nmv","4hwb","6vtu","6wo5","6wo5","6wo5","6wo5","8v2e","8v2e","8fgx","8dis","8dis","8dis","5t80","2vxs","2vxs","2vxs","2vxs","6h06","6h06","6h06","6h06","6mto","4ers","5u3k","5u3k","8f38","8f38","8f38","8a95","8a95","8a95","7amp","7bbg","5eu7","5eu7","5lcv","4mwf","4mwf","8qh1","8hpv","8hpv","8hpv","8hpv","8hpv","8hpv","7uqc","7uqc","7uqc","7uqc","8ee0","7ul1","7a3t","7m7w","7m7w","7m7w","7m7w","6urm","6urm","3lh2","3lh2","3lh2","3lh2","7chy","7jx3","7jx3","7jx3","6h2y","7f15","4xwg","8tzw","8caf","8caf","8e8r","8gs9","7yad","7yad","4fz8","7m71","5x8m","8da1","6cw2","6wix","6wix","7nxb","7nxb","7rnj","7chf","7chf","8c0y","8v4f","8dy1","8dy1","3ngb","3ngb","3ngb","3ngb","4ngh","8jnk","8jnk","8jnk","8jnk","8ija","7xeg","7xeg","4nnp","4nnp","7t01","6xc3","6xc3","8u5l","8u5l","8u5l","8u5l","8u5l","8yww","8yww","8yww","8yx1","8yx1","8vye","8vye","8vye","8vye","8vye","8vye","8vye","8vye","8vye","8gav","8cin","8cin","8cin","8i5l","8i5l","8jgf","8hq7","8hq7","8f7z","8f7z","8f7z","8f7z","8euu","8euu","8euu","8euw","8euw","8euw","7yk4","7yk4","8e6j","8e6j","8e6j","8e6j","8dz3","8dz3","8dz3","8dz3","8dz3","8dz3","8dz3","8ee1","8ee1","8a96","7x08","7x08","7x08","7t75","8df5","8df5","8df5","8df5","4ydv","4ydv","3dvn","3dvn","2vh5","6z3q","3mlw","3mlw","6u36","7kn4","7kn4","3nh7","3nh7","3nh7","3nh7","1hez","1hez","6b0h","6b0h","6cmg","7a3q","7a3q","5wi9","5wi9","3lhp","3lhp","3h3p","3h3p","1dee","1dee","1dee","6iek","6iek","6bck","7rfb","7rfb","7vla","6umg","6umg","7s8h","7s8h","5j74","5j74","7rks","7rks","6uuh","6uuh","7czt","7czt","1bvk","1bvk","2xtj","2wuc","2p8m","6umj","3sqo","7q6e","7q6e","7q6e","6hhc","3gbm","3gbm","5uem","7cj2","7cj2","6mtq","2h32","7ch5","7ek0","6bgt","2p8p","6q0i","5gmq","7jn5","4olw","8sdg","8sdg","8jen","8jen","8jen","8jen","7cm4","7chc","7chc","6ck9","6ck9","6vzi","6vzi","8y6a","8u03","4yjz","6xkp","6xkp","6mi2","6mi2","4ye4","6cmi","8r4o","8r4o","8r4o","8r4o","8r4o","8r4o","5yoy","5yoy","5yoy","5yoy","5yoy","5yoy","8dxu","8dxu","8u31","8wz2","8e8s","4xbg","4xbg","4xbg","4xbg","4xbg","4xbg","6u38","6nm6","6nm6","6nm6","8rdf","5u3j","4xrc","4xrc","5utz","5utz","5utz","5utz","8txp","8hp9","8hp9","8hp9","8hp9","8hp9","8hp9","8tui","8bbo","6u8k","6u8k","6u8k","6q0h","7shu","7shu","1zlu","1zlu","4zff","4zff","2qqk","6ppg","6ppg","6wh9","6wh9","6wh9","5te4","1yyl","1yyl","6xe1","4o58","5gzo","5gzo","7dc8","7dc8","4rnr","4rnr","6mnf","6mnf","5l0q","5l0q","7xei","7xei","6wxl","6wxl","6wxl","7vv5","7u2d","6ncp","6ncp","7enf","6nnf","6nnf","6nnf","8w85","8w85","8xqo","8eoo","8eoo","8eoo","8eoo","3mlu","6ogx","6ogx","4lmq","4lmq","8keo","8keo","8keo","8ez8","7l0n","7l0n","7l0n","7l0n","7e7x","7e7x","6cyf","6cyf","6cyf","6cyf","5kan","5kan","5kan","8tm1","7u9w","7xnf","8gpu","8gpu","8gpu","8gpu","8gpu","8gpu","5vqm","5vqm","4rrp","4rrp","4rrp","4rrp","4rrp","4rrp","6umx","6umx","6rps","6rps","6kvf","6kvf","5w6g","7kfw","7kfw","7kfw","8rpb","4r8w","6bkb","8vyn","8vyn","8vyn","8vyn","8vyn","8vyn","8hlc","8hlc","8hlc","8hld","8hld","8hld","8p5m","8wsn","8wsn","8uwl","8ut3","8yx9","8yx9","8yx9","8yx9","8j6j","8tp7","8tp7","8tp7","8t7a","8t7a","8t7a","8j7e","8j7e","8tco","8tco","8g40","8g40","8g40","8eit","7xs8","7soe","7soe","7soe","7v5k","7v5k","7v5k","7ua8","7ua8","7wn8","7wn8","7wqv","7wqv","7wqv","7wqv","7wqv","7wqv","7wqv","7wqv","7v5j","7v5j","7v5j","8dao","8dao","2oqj","2oqj","2oqj","2oqj","2r56","2r56","7s0x","7s0x","7pc2","7pc2","7pc2","7pc2","7pc2","7pc2","5xmh","5xmh","7czx","7czx","7czx","4dn4","6z3p","3eoa","3eoa","7qf1","7qf1","7wwm","7wwm","7wwm","6v4o","6v4o","6v4o","6v4o","7a3o","3lzf","6vn1","6vn1","6vn1","5ggt","6mhr","6mhr","5iwl","5iwl","4yk4","4yk4","5yy5","5yy5","6b3s","6b3s","6b3s","6b3s","6pi7","6pi7","7lxw","5bk3","5bk3","5bk3","5bk3","5kn5","5kn5","5sx4","5sx4","7uap","7uap","7uap","7ttx","7k37","7k37","7k37","6pzf","6pzf","6yax","6yax","7lbf","7lbf","2fjg","2fjg","7np1","7np1","7np1","7np1","7czw","7czw","7m3i","7m3i","7nd9","7tyv","7tyv","7tyv","2qsc","2ny6","6mej","6mej","3l5y","3ux9","3ux9","3r1g","7czq","7czq","7e5o","6gv4","2jb5","4g7y","7w55","4ps4","5ugy","5ugy","5ugy","7df1","7df1","7df1","7df1","8ruu","8ruu","8g4t","8g4t","8g4t","8dgw","8dgw","8dgw","8dgw","7wkx","7wkx","7cu5","7cu5","7duo","4kht","8w83","8w83","8w83","8w83","5dur","5dur","4jkp","6wgl","4jpv","7wy0","7wz7","4kxz","4kxz","4kxz","4kxz","7tb8","7tb8","7tb8","7tb8","7kzb","7kzb","8r4q","8r4q","8r4q","8r4q","8r4q","8r4q","6mwn","6mwn","8sdh","8sdh","8jgb","8gur","6pe8","6pe8","7qny","7qny","7vuy","4irz","5k59","5k59","6vgr","6vgr","6uym","6uym","8hpq","8hpq","8hpq","8hpq","8hpq","8hpq","7ycn","7ycn","7ycn","7ycn","7tn0","7tn0","7tn0","7tn0","6ywc","6ywc","1zlw","1zlw","2jb6","2jb6","7l0l","7l0l","7l0l","5anm","5anm","5anm","6oc3","6oc3","6uyn","7u2e","6gk8","7bwj","6cbj","3ob0","3ob0","3sdy","6yxm","4i3s","4y5y","4y5y","8gf2","8gf2","8gf2","8gf2","8hrd","8hrd","8hrd","8hrd","8hrd","8hrd","8hrd","8hrd","7s5p","7uxl","7uxl","7eo4","3nfp","3nfp","5o1r","5o1r","7quh","8kdm","8kdm","8k3c","8bg1","8bg1","8bg1","8bg1","7xsc","7xsc","7s5q","7s5q","7c01","7c01","7kqe","7kqe","7kqe","6xc7","6xc7","8u1c","8el2","8el2","7xik","8dgx","8dgx","6ye3","6ye3","6ye3","4m8q","4m8q","7eo2","5tzt","5tzt","7qez","7qez","5a3i","5a3i","7wph","7wph","7jmw","7vmu","4np4","4np4","7vuz","5f9w","5f9w","5xwd","8vvm","8vvm","8zqe","8r9z","8r9z","8jpn","8sxp","8wsq","8hgl","8hgl","8hgl","8tp5","8tp5","8tp5","7xxh","8g3n","8g3n","8g3n","8g3n","8h07","8h07","8h07","8h07","8h07","8h07","7uc8","7uc8","7uc8","8eb2","8eb2","8eb2","8d3a","7sue","7sue","7sue","7sue","7lue","7lue","7lue","5bzw","4xcn","4xcn","4xcn","4xcn","4xcn","4xcn","1rzk","6erx","6erx","6erx","6erx","6erx","6erx","7keo","7keo","6yxd","7r40","7r40","7r40","3hae","3hae","3hae","3hae","6fxn","6fxn","6fxn","6fxn","6fxn","6fxn","7lbe","7lbe","7t4q","7t4q","7t4q","5jxe","5jxe","6iw2","6iw2","6iw2","6iw2","6iw2","6iw2","7E+86","6v8z","6v8z","6v8z","6v8z","6v8z","6v8z","6o25","6o25","6o25","6woz","6woz","6woz","6woz","5wux","5wux","5wux","2wub","2wub","6jjp","6jjp","7rco","7rco","5usl","5usl","5xxy","5usi","5usi","6oan","6oan","6ute","6ute","6ute","6ute","6ute","6fgb","7vl8","7fjs","7fjs","5erw","3be1","6uj9","6wds","6phc","6phc","6ss4","7s0b","7s0b","3hi1","3hi1","1g9n","6uvo","6e3h","7w56","6b9j","6b9j","7vdh","6kpf","5gjs","6mei","5y2l","6lxj","6lxj","6lxj","6lxj","4jpw","6t9d","6t9d","5v7j","5v7j","8sit","8sit","8sit","8sit","8hwt","8hwt","8e8x","7xil","6muf","6muf","6mg7","6s8j","6s8j","6s8j","4py8","4j4p","4j4p","6wmw","6wmw","4nhc","8j6i","7uvi","7uvi","7ps0","7ps0","5w4l","5w4l","5w4l","5w4l","7qnx","7qnx","6ml8","7pr0","7pr0","7pr0","4khx","8kep","7x10","8xqt","8hnm","7y0c","7y0c","5mev","4fp8","4fp8","4fp8","4fp8","8ker","8ker","8ker","8g4m","8g4m","8g4m","8iys","6vmj","6vmj","6vmj","6vmj","6m58","6m58","7zf8","7m7b","7k9z","7k9z","7r6x","7r6x","7r6x","7z0y","6nz7","6nz7","5c7x","5c7x","6gk7","6mug","6mug","8kfx","8ttw","8ttw","8ttw","8ttw","8ttw","8ttw","7yix","7yix","7fjc","6wir","7cdi","8vmb","7y3n","7y3n","7y3n","8pg0","8gus","7wyb","7l2e","7l2e","7l2e","7mw2","7mw2","7mw2","7vv3","7lab","7lab","7lab","5k9k","5k9k","8hnl","8gut","7wlz","7vdm","7b0b","5kjr","6t9e","6t9e","8tx3","8tx3","8tx3","8yky","7yrn","7yrn","7yrn","7yd1","7ps2","7ps2","6s8i","6s8i","6s8i","7bq5","7bq5","7xh8","6fax","3mlz","6xqw","6mu8","6mu8","8t9z","4ywg","4ywg","6dc9","6dc9","8vcr","8vcr","8vcr","8r9y","8r9y","8v6u","8khc","8khc","8gat","8g8n","8g8n","8g8n","8g8n","8g8n","8g8n","8jgg","8fja","8hn8","8hoc","8ucd","8trt","8trt","8w8b","8g05","8tpa","8tpa","8tpa","8s9g","4kv5","4kv5","4kv5","4kv5","8gpi","8gpi","8gpi","7trh","8dyx","8dyx","8dyx","8dyx","8dyx","8dyx","8dyx","8dyx","8dyx","8dyx","8dyx","8cim","8cim","8cim","8g3m","8g3m","8g3m","8ejc","8hn7","8hn7","6vug","7w3z","7w40","4ypg","4ypg","6pzw","6pzw","6pzw","6pzw","7wwl","7wwl","7wwl","6mfp","6mfp","7dk2","7dk2","7dk2","7dk2","4hj0","4hj0","4z5r","4z5r","4z5r","4z5r","4z5r","4z5r","4z5r","4z5r","6vvu","6vvu","6vvu","6vvu","6xlq","6xlq","6xlq","6xlq","5xez","5xez","7jwp","7jwp","7jwp","7jwp","7jwp","7jwp","7jwp","7jwp","7shy","7shy","7shy","7shy","7pqy","7pqy","7k39","7k39","7k39","7si0","7si0","7si0","7si0","7lxx","7epx","7epx","7czp","7czp","6s3d","6s3d","6s3d","6s3d","7jv6","7jv6","7jv6","7a3u","2fl5","2fl5","2fl5","2fl5","7l7e","7l7e","7l7e","7l7e","7l7e","7l7e","7l7e","7l7e","3hmx","6v8x","6v8x","6v8x","7f6z","6q0o","7ly3","7ly3","4p9h","5hhx","4dke","4dke","5vig","5vig","1op5","1op5","7shz","7shz","7shz","7shz","2j6e","2j6e","6n2x","6n2x","2a9n","2a9n","7n8i","6p3r","6p3r","5gzn","5gzn","7f6y","7raj","7d00","7d00","4i3r","5tru","5tru","7klh","7klh","4uta","4uta","5vic","5i9q","5i9q","6apb","4lsv","6al5","6kpg","7mrz","7tly","5o4g",
] # bound, more than 2.5A resolution

pathological += [
    "5vzx","5vzx","5kmv","5kmv","5uix","8vk2","8vk2","3x3g","7lyw","7lyw","7lyw","8t8i","8t8i","8t9y","8t9y","5szf","5jo4","5jo4","7jmx","6ehv","8t6i","8t6i","8eqa","8eqa","6gc2","5vsh","5vsh","5vsh","5vsh","7s8g","7s8g","6qf6","6qf6","6qf6","6qf6","3qeh","3qeh","3qeh","3qeh","5jqd","5jqd","8t7i","5i15","3u7w","3l7f","3l7f","3l7f","5esa","6foe","6foe","1dql","7kx4","7kx4","5uby","2agj","5xrq","5xrq","4dn3","1mim","3nfs","4hfw","4hfw","6wor","6u8c","6u8c","4od3","3kym","3kym","3kym","3kym","3kym","3kym","3kym","3kym","6mfj","6mfj","7ti6","3rpi","3rpi","8tv2","8tv2","7t99","7t99","7t99","7t99","4gw4","4gw4","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","2fjf","4nm4","4nm4","6jc2","5i8e","5i8e","5f6h","5f6h","5f6h","5f6h","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","8vs8","3u6r","3u6r","1hkl","5fuz","4xml","4od1","5trp","8tjt","8tjt","8tjt","8tjt","8gbx","8ekh","5i1e","5grz","5grz","6z3k","6z3k","6z3k","6z3k","6z3k","6z3k","6z3k","6z3k","6z3k","5bzd","5bzd","1fve","1fve","4py7","4py7","1hzh","1hzh","1dfb","6ca9","6ca9","6q1j","7wc0","7wc0","7rdl","7rdl","5tqa","5tqa","5bq7","6g8r","5tgb","5tgb","8ia6","8ia6","8h3b","8h3b","8ojs","8ojs","5ubz","5n4g","4r7d","4r7d","4r7d","4r7d","4r7d","4r7d","4r7d","4r7d","7re9","7re9","6u85","5f89","5f89","6fg2","6fg2","6fg2","6fg2","7u0b","1ad9","1ad9","4nyl","4nyl","4nyl","4nyl","5grw","5grw","1za6","1za6","1za6","1za6","7kba","7kba","7cu7","5iie","5iie","6mh2","6mh2","4jy4","6w73","4m6o","4oaw","4oaw","6amm","5i19","1u6a","4xcc","7l79","7l79","1qlr","1qlr","7vmz","3p0v","3p0v","4evn","4evn","4evn","4evn","4evn","4evn","4evn","4evn","3u4b","4odh","7lud","7lud","1rzi","1rzi","1rzi","1rzi","1rzi","1rzi","1rzi","1rzi","5cd3","5cd3","5cd3","5cd3","1b4j","5uy3","5uy3","1fh5","6mef","3u46","3u46","4xce","4xce","4xce","4iml","4iml","4xbp","4xbp","4xbp","4xbp","7bm5","7bm5","7bm5","7bm5","7bm5","7bm5","3f12","3f12","6mty","7t98","7t98","4ky1","7rqp","8tfr","5bk5","5bk5","5bk5","5bk5","4hk3","2ig2","7vsw","7vsw","7vsw","7vsw","1t04","1t04","6nb5","6nb5","4x7t","4x7t","3hmw","4qhn","2fgw","4fq1"
    ] # unbound, more than 2.5A resolution
pathological += ['7uvl', '7xq8'] # unbound, 0A in SAbDab but more than 2.5 resolution in the PDB
pathological +=  [    '7uow', '7xj6', '7xj8', '7xj9', '8saq', '8sar', '8sas', '8sau', '8sav',     '8saw', '8sax', '8say', '8saz', '8sb0', '8sb1', '8sb2', '8sb3', '8sb4',     '8sb5', '8d21', '8dmh', '8d7e', '8il3', '7x93', '7x94', '7x95', '7x96',     '8bcz', '8ek1', '8eka', '8id3', '8id4', '8id6', '8id8', '8id9', '7ru8',     '7ru5', '7e9o', '7ru4', '7x9y', '7vkt', '7ru3', '7xa3', '8g59', '8hs3',     '8c7h', '7u0q', '7u0x', '7wsc', '7xcz', '7xda', '7xdb', '7xdk', '7xk2',     '7wwi', '7wwj', '7wwk', '8f6e', '8f6f', '8f6h', '8f6i', '8f6j', '7wr9',   '8hhx', '8hhy', '8hhz', '7t5o', '8d48', '8hc2', '8hc3',     '8hc4', '8hc5', '8hc6', '8hc7', '8hc8', '8hc9', '8hca', '8hcb', '7wh8',     '7whb', '7whd', '7yar', '7wck', '7wcp', '7wcu', '7ykj', '7wti', '7wur',     '7wtf', '7wtg', '7wth', '7wtj', '7wtk', '8diu', '7x8w', '7x8y', '7x90',     '7x91', '7x92', '8dw2', '8dw3', '7wos', '7wop', '7woq', '7wor', '7wou',     '7wov', '7wow', '8e9y', '7t17', '7u9o', '7u9p', '8dvd', '7six', '7sj0',     '8dim', '7uot', '7uov', '7z12', '7wbh', '7yr1', '7y24', '7y26', '7y27',     '7yr0', '7zce', '7zcf', '7wrj', '8e7m', '7zlk', '7srr', '7xco', '7tjq',     '7tl0', '7xxl', '7sjn', '7sjo', '7xck', '7xcp', '8dad', '8dlr', '8dls', '8dpf', '8dpg', '8dph', '8dpi', '8dzh', '8dzi', '7usl', '7xw7',     '7zbu', '7upl', '7u0p', '7z3a', '7v23', '7v24', '7v27', '7wcd', '8cw9',     '7t9n', '7qti', '7qtj', '7qtk', '7wjy', '7ums', '7t0w', '7t0z', '7sk3',     '7sk4', '7sk8', '7sk9', '7wo4', '7wo5', '7wo7', '7woa', '7wob', '7woc',     '7wog', '7wp0', '7wj5', '7wjz', '7wk0', '7x6a', '7x1m', '7ran', '7wro',     '7wr8', '7xjl', '7xjk'] # bound, 0A in SAbDab but more than 2.5 resolution in the PDB
pathological += ['5umn', '7jmp', '5bv7', '6ca6', '8dy5',  '7dm1', '3hi6', '7t25', '6kz0'] # missing residues

for file in file_list:
    #file = '/Users/kevinmicha/Documents/all_structures/chothia_gcn/8qh0.pdb'
    print(file[-8:-4])
    if os.path.isfile(CM_DIR+f'{file[-8:-4]}.npz') and file[-8:-4] not in pathological:
        try:
            amino_acids_data = parse_pdb(file)
            if amino_acids_data:
                avg_b_factors, unp = compute_average_b_factors(amino_acids_data, b_factor_thr=args.thr)
                if unp == False:
                    b_factors.append(torch.Tensor(avg_b_factors))
                    pdb_codes.append(file[-8:-4])
                    #pdb_codes.append(file[-17:-13])
        except:
            pass  

if b_factors:
    torch.save(b_factors, DATA_DIR+'b_factors.pt')
    np.save(DATA_DIR+'pdb_codes.npy', pdb_codes)